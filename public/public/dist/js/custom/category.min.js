"use strict";function resfreshJSTree(){setTimeout(function(){$("#evts").jstree(!0).refresh()},500)}function resetForm(){$("#status").val("Active").trigger("change"),$("#is_searchable").val(1).trigger("change"),$("#edit_id").val(null),$(".custom-file-label").text("Upload image"),$("#imageBlock").hide(),$("#note_txt_2").hide(),document.getElementById("categoryFrom").reset()}function getInfo(e,t,a){$("#imageBlock").show(),$(".cursor_pointer > img").remove(),$(".sub-category").is(":disabled")&&1==t?$(".sub-category").prop("disabled",!1):$(".sub-category").is(":disabled")||0!=t||$(".sub-category").prop("disabled",!0),editId=e,$.ajax({url:SITE_URL+"/categories/edit",type:"POST",data:{_token:token,id:e,create_child:t},dataType:"json",success:function(e){$("#name").val(e.name),$("#slug").val(e.slug),$("#status").val(e.status).trigger("change"),$("#is_searchable").val(e.is_searchable).trigger("change"),$("#is_featured").val(e.is_featured).trigger("change"),$("#sell_commissions").val(getDecimalNumberFormat(e.sell_commissions)),$("#edit_id").val(editId),$(".cursor_pointer").append('<img class="profile-user-img img-responsive fixSize" src="'+e.image_path+'" alt="" class="img-thumbnail attachment-styles"/>'),null!=e.parent_id?($("#parentBlock").show(),$('select[name="parent_id"]').empty(),$('select[name="parent_id"]').append('<option value="'+e.parent_id+'">'+e.parent_name+"</option>")):($('select[name="parent_id"]').empty(),$("#parentBlock").hide())}})}function doMoveNode(e,t,a,o,s){clickOnSave("/categories/move-node","POST",{id:e,parent:t,old_parent:a,position:o,old_position:s}),resetForm(),resfreshJSTree()}var selectedNodeId,selectedNodeName,editId;$(".main-body .page-wrapper").find("#category-info-container").length&&(editId=selectedNodeName=selectedNodeId="",$(".sub-category").prop("disabled",!0),$("#parentBlock").hide(),$(".delete").hide(),$("#imageBlock").hide(),$(".select2").select2(),$(document).on("keyup","#name",function(){var e=this.value.replace(/[&\/\\#@,+()$~%.'":*?<>{}]/g,"");$("#slug").val(e.trim().toLowerCase().replace(/\s/g,"-"))}),$(document).on("keyup","#slug",function(){var e=this.value.replace(/[&\/\\#@,+()$~%.'":*?<>{}]/g,"");$("#slug").val(e.trim().toLowerCase().replace(/\s/g,"-"))}),$("#categoryFrom").on("submit",function(e){e.preventDefault();let t="";e=new FormData(this);"store"==$("#type").val()?t="/categories/store":"edit"==$("#type").val()&&(t="/categories/update"),clickOnSaveForm(t,"POST",e),resetForm(),resfreshJSTree()}),$("#validatedCustomFile").on("change",function(){for(var e=[],t=0;t<$(this)[0].files.length;t++)e.push($(this)[0].files[t].name);$(this).next(".custom-file-label").html(e.join(", "));var a=this.files[0].type;return $.inArray(a,["image/jpg","image/jpeg","image/png"])<0?($("#divNote").show(),$("#note_txt_1").hide(),$("#note_txt_2").html('<h6> <span class="text-danger font-weight-bolder">'+jsLang("Invalid file extension")+'</span> </h6> <span class="badge badge-danger">'+jsLang("Note")+"!</span> "+jsLang("Allowed File Extensions: jpg, png, gif, bmp")),$("#note_txt_2").show(),$("#prvw").hide(),!1):($("#prvw").show(),$("#note_txt_2, #note_txt_1").hide(),!0)}),$(".sub-category").on("click",function(){resetForm(),$("#parentBlock").show(),$('select[name="parent_id"]').empty(),$('select[name="parent_id"]').append('<option value="'+selectedNodeId+'">'+selectedNodeName+"</option>"),$("#type").val("store"),$(".delete").hide()}),$(".root-category").on("click",function(){$("#evts").jstree(!0).deselect_all(),$("#parentBlock").hide(),resetForm(),$("#type").val("store"),$(".delete").hide()}),$(".delete").on("click",function(){confirmDeleteAjax("/categories/delete","POST",selectedNodeId,"resfreshJSTree"),$(".sub-category").prop("disabled",!0),resetForm()}),$("#evts_button").on("click",function(){var e=$("#evts").jstree(!0);e.deselect_all(),e.select_node("1")}),$("#evts").on("changed.jstree",function(e,t){t.selected.length&&($("#type").val("edit"),$(".delete").show(),selectedNodeId=t.instance.get_node(t.selected[0]).id,selectedNodeName=t.instance.get_node(t.selected[0]).text,getInfo(selectedNodeId,t.instance.get_node(t.selected[0]).original.create_child))}).on("move_node.jstree",function(e,t){t.node.parents.length<4?doMoveNode(t.node.id,t.parent,t.old_parent,t.position,t.old_position):(swal(jsLang("Not Permitted"),{icon:"error",buttons:[!1,jsLang("Ok")]}),resfreshJSTree())}).jstree({core:{check_callback:!0,data:{url:SITE_URL+"/categories/get-data",dataType:"json"}},plugins:["dnd"]}));
