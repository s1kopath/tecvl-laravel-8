$.fn.isInViewport=function(){return 0!=this.length&&this[0].getBoundingClientRect().top<$(window).height()};class AjaxRequest{static async call(a,b={}){return await fetch(a,Object.assign({method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json"}},b)).then(a=>a.json()).then(a=>a.response)}}class Dashboard{element;fetched=!1;links=[];params={};static getObject(){return null==this.myself&&(this.myself=new this),this.myself}async update(b){this.fetched=!0;let a=await AjaxRequest.call(b,this.params);if(this.getStatus(a))this.renderData(this.element,a);else throw new Error(this.getErrMessage(a))}sliceData(a,b=5){return a.slice(0,b)}switchView(){this.element.find(".placeholder-data").addClass("d-none"),this.element.find(".original-data").removeClass("d-none")}sync(a){this.hasObject()&& !this.fetched&&this.element.isInViewport()&&a&&this.update(a)}hasObject(){return void 0!=this.element&&!(this.element.length<1)}renderData(){throw new Error("Must implement renderData() method.")}getStatus(a){return!0}getErrMessage(a){return a.status.message}formatString(a,b=20,c="..."){return a.length>b-c.length?a.substr(0,b)+c:a}formatUrl(a,b,c=null){return c?a.replace(c,b):a.replace("__id__",b)}addLink(a,b){return this.links[b]=a,this}getLink(a,b,c=null){return void 0==this.links[a]?"#":c?this.links[a].replace(c,b):this.links[a].replace("__id__",b)}setParams(a){return this.params=a,this}resetFetch(){return this.fetched=!1,this}}class DashReport extends Dashboard{static myself=null;constructor(){super(),super.element=$("#dashboard-reports")}renderData(b,a){a=super.sliceData(a.records);let c="";a.forEach(a=>{c+="<tr class='unread'><td><img></td>",c+="<td><h6>"+a.title.substr(0,20)+"</H6></td>",c+='<td class=""><h6>11 MAY 12:56</h6></td>',c+='<td class=""><a href="#!" class="label bg-c-blue text-white f-12">View</a></td>',c+="</tr>"}),b.find(".original-data").append(c),super.switchView()}}class VendorStats extends Dashboard{static myself=null;constructor(){super(),super.element=$("#vendor-stat")}renderData(b,a){a=super.sliceData(a.records);let c="",d=1;a.forEach(a=>{if(a.name){c+="<tr class='unread'><td><h6 class='mb-1'>"+d+++"</h6></td>",c+='<td><h6 class="has-dash-popup" data-url="'+a.url+'">'+a.name.substr(0,20)+"</H6></td>",c+='<td class="text-center">';for(let b=1;b<=5;b++)a.ratings>0?c+='<a href="#!"><i class="fa fa-star f-12 text-c-yellow"></i></a>':c+='<a href="#!"><i class="fa fa-star f-12 text-black-50"></i></a>',a.ratings--;c+="</td>",c+='<td><h6 class="text-center m-b-0">'+a.orders+"</h6></td>",c+='<td><h6 class="text-center m-b-0">'+a.sales+"</h6></td>",c+='<td class="text-center"><a href="'+super.getLink("edit",a.id)+'" class="label theme-bg f-12 text-white">'+jsLang("VIEW")+"</a></td>",c+="</tr>"}}),b.find(".original-data").append(c),super.switchView()}}class MostVisitedReport extends Dashboard{static myself=null;constructor(){super(),super.element=$("#most-visited-page")}renderData(b,a){a=super.sliceData(a.records);let c="";a.forEach(a=>{c+='<tr class="unread">',c+="<td><H6>"+a.title.substr(0,20)+"</H6></td>",c+='<td class="text-right"><h6>'+Math.floor(100*Math.random()+50)+"</h6></td>",c+="</tr>"}),b.find(".original-data").append(c),super.switchView()}}class CustomerComplain extends Dashboard{static myself=null;constructor(){super(),super.element=$("#customer-complain")}renderData(a,b){super.switchView()}}class MostActiveUsers extends Dashboard{static myself=null;constructor(){super(),super.element=$("#most-active-users")}renderData(b,a){a=super.sliceData(a.records);let c="";a.forEach(a=>{c+="<tr class='unread'>",c+='<td><h6 class="has-dash-popup" data-url="'+a.profile+'">'+super.formatString(a.name)+"</h6></td>",c+='<td class="text-right">'+a.total+" </td>",c+="</tr>"}),b.find(".original-data").append(c),super.switchView()}}class MostSoldProducts extends Dashboard{static myself=null;constructor(){super(),super.element=$("#most-sold-products")}renderData(b,a){a=super.sliceData(a.records);let c="";a.forEach(a=>{c+="<tr class='unread'>",c+=`<td><h6 class='m-0 p-0 btn has-dash-popup' data-url='${a.url}'>${super.formatString(a.name)}</h6></td>`,c+='<td class="text-right">'+a.total+" </td>",c+="</tr>"}),b.find(".original-data").append(c),super.switchView()}}class SaleOfThisMonth extends Dashboard{static myself=null;constructor(){super(),super.element=$("#sale-of-this-month")}renderData(a,b){this.lineChart(a,b),super.switchView()}lineChart=(a,c)=>{a.find(".placeholder").addClass("d-none");let b=a.find("#chart-area-2");b.removeClass("d-none"),this.updateChart(b[0],c.records)};updateChart=(d,b)=>{var c=d.getContext("2d"),a=c.createLinearGradient(0,0,500,0);a.addColorStop(0,"rgba(29, 233, 182, 0.8)"),a.addColorStop(1,"rgba(29, 196, 233, 0.8)");var e={labels:b.dates,datasets:[{label:b.thisMonth,data:b.values,borderWidth:4,borderColor:a,backgroundColor:a,hoverborderColor:a,hoverBackgroundColor:a,tension:.1},]},f=new Chart(c,{type:"line",data:e,responsive:!0,fill:!0,options:{scales:{y:{title:{display:!0,text:"Sales"}}}}})}}class VendorReq extends Dashboard{static myself=null;constructor(){super(),super.element=$("#vendor-request")}renderData(b,a){a=super.sliceData(a.records);let c="";a.forEach(a=>{c+='<tr class="unread">',c+='<td> <img class="rounded-circle" style="width:40px;" src="'+a.file_url+'" alt="activity-user"> </td>',c+='<td><h6 class="user-has-popup mb-1">'+a.name.substr(0,20)+"</h6></td>",c+='<td class="text-center"> <h6 class="text-muted">'+a.created_at+"</h6></td>",c+='<td class="text-right"> <a href="'+a.view+'" class="label bg-c-blue text-white f-12">'+jsLang("View")+'</a><a href="javascript:void(0)" class="label theme-bg f-12 text-white vendor-req" data-url="'+a.accept+'">'+jsLang("Accept")+'</a><a href="javascript:void(0)" class="label theme-bg2 text-white f-12 vendor-req" data-url="'+a.reject+'">'+jsLang("Reject")+"</a></td>",c+="</tr>"}),b.find(".original-data").append(c),super.switchView()}}$(document).ready(function(){let a=()=>{DashReport.getObject().sync(),MostVisitedReport.getObject().sync(),CustomerComplain.getObject().sync(),VendorStats.getObject().addLink(vendorEdiUrl,"edit").sync(vendorStatsUrl),MostActiveUsers.getObject().sync(mostActiveUsersUrl),MostSoldProducts.getObject().sync(mostSoldProductsUrl),SaleOfThisMonth.getObject().sync(salesOfThisMonth),VendorReq.getObject().addLink(vendorReqsUrl,"edit").sync(vendorReqsUrl)};function b(){$(".placeholder-data-sta").removeClass("d-none"),$(".original-data-sta").addClass("d-none"),$(".original-data-sta").empty()}$(document).scroll(()=>{a()}),$(document).on("click",".daily",function(a){a.preventDefault(),b(),VendorStats.getObject().resetFetch().sync(vendorStatsUrlDaily)}),$(document).on("click",".weekly",function(a){a.preventDefault(),b(),VendorStats.getObject().resetFetch().sync(vendorStatsUrlWeekly)}),$(document).on("click",".monthly",function(a){a.preventDefault(),b(),VendorStats.getObject().resetFetch().sync(vendorStatsUrlMonthly)}),$(document).on("click",".yearly",function(a){a.preventDefault(),b(),VendorStats.getObject().resetFetch().sync(vendorStatsUrlYearly)}),$(document).on("click",".vendor-req",function(a){a.preventDefault();let b=$(this).attr("data-url");$(".placeholder-data-req").removeClass("d-none"),$(".original-data-req").addClass("d-none"),$(".original-data-req").empty(),VendorReq.getObject().resetFetch().sync(b)}),a()})
