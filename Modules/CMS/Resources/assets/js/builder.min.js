"use strict";var pendingForm;const alertBox=$(".js-alert");$(document).on("submit","form#layout_selector",function(a){a.preventDefault();let b=this.action.replace("__file",this.querySelector("#l_layout").value);updateFormButton(this),ajaxRequest($(this),b,replaceForm)}),$(document).on("change",".category_type",function(){"selectedCategories"==this.value?(this.closest("form").querySelector(".cats").classList.remove("d-none"),$(this.closest("form")).find(".cats .crequired").attr("required","")):(this.closest("form").querySelector(".cats").classList.add("d-none"),$(this.closest("form")).find(".cats .crequired").removeAttr("required"))}),$(document).on("submit","form.component_form",function(a){a.preventDefault();let b=this.action.replace("__id",__page);processComponentForm(getDraggableParent(this)),validateFormData(this)&&(updateFormButton(getDraggableParent(this)),ajaxRequest($(this),b,updateComponent,"post"))}),$(document).on("keyup","#section_name",function(){let a=getDraggableParent(this);a.querySelector(".header-title").innerHTML=this.value}),$(document).on("click","#update_page",function(){let a=sortable.sortable("toArray",{attribute:"data-id"}),b=[];a.filter(Boolean).forEach((a,c)=>{b.push({id:a,level:c})}),$(this).find(".loading-spinner").toggleClass("d-none"),updateCustomForm(JSON.stringify(b)),ajaxRequest($("#internal_form"),__savePageUrl,pageUpdated,"post")}),$(document).on("click","#add-new-widget",function(){sortable.append(selector),$("html, body").animate({scrollTop:$(document).height()},"slow"),updateSelect2Fields()}),$(document).on("change","#l_category",function(){$(".layoutBlocks").hide(),$("#"+this.value).show()});const ajaxRequest=(a,b,c,d="get")=>{let e={};if(a){var f=a.find("input, select, button, textarea");a.serializeArray().forEach(a=>{let[b,c]=[a.name,a.value];b.endsWith("[]")?(b=b.slice(0,-2),!e[b]&&(e[b]=[]),e[b].push(c)):e[b]=c}),f.prop("disabled",!0)}pendingForm=a;let g={method:d,headers:{"Content-Type":"application/json"}};("POST"===d||"post"===d)&&(g.body=JSON.stringify(e)),fetch(b,g).then(a=>a.json()).then(b=>{c(a,b.body),f.prop("disabled",!1)}).catch(b=>{throw f.prop("disabled",!1),operationFailed(jsLang("Operation failed.")),updateAjaxMessage(a,jsLang("Operation failed."),"danger"),updateFormButton(a),b})},replaceForm=(a,b)=>{let c=getDraggableParent(a);c.find(".header-title").html(b.title),c.find(".header-text").append(b.header),c.find(".dd-content").remove(),c.append(b.html),$("#update_page .loading-spinner").toggleClass("d-none"),operationSuccess(jsLang("Section added. Please fill up the section information and save.")),updateSelect2Fields()},updateComponent=(a,b)=>{a.find(".component").val(b),updateFormButton(getDraggableParent(a)),updateAjaxMessage(getDraggableParent(a),jsLang("Section updated.")),getDraggableParent(a).data({id:b}),getDraggableParent(a).data({id:b}),operationSuccess(jsLang("Section Updated"))},processComponentForm=a=>{let b,c=$(a).data("id");if(c){let c=sortable.sortable("toArray",{attribute:"data-id"}).filter(Boolean);b=c.indexOf($(a).data("id").toString())}else b=Array.from(a.parentNode.children).indexOf(a);a.querySelector("input.order").value=b},getDraggableParent=a=>a.closest(".ui-state-default"),deletedGrid=a=>{a?operationSuccess(jsLang("Section deleted")):operationFailed(jsLang("Couldn't delete the section"))},updateCustomForm=a=>{document.querySelector("#internal_form #data").value=a},pageUpdated=()=>{$("#update_page .loading-spinner").toggleClass("d-none"),operationSuccess(jsLang("Page updated"))},operationSuccess=a=>{showNotification("success",jsLang(a))},operationFailed=a=>{showNotification("danger",jsLang(a))},showNotification=(a,b)=>{alertBox.find(".alertText").html(b),alertBox.find(".alert").attr("class",`alert alert-${a}`),alertBox.removeClass("d-none")};$(".close").click(function(){alertBox.addClass("d-none")});const showSliderOptions=a=>{let b=getDraggableParent(a);$(b).find(".sliderOptions").show(),hideBannerOptions(b),hideFlashOptions(b)},hideSliderOptions=a=>{$(a).find(".sliderOptions").hide()},showBannerOptions=a=>{let b=getDraggableParent(a);$(b).find(".bannerOptions").show(),hideSliderOptions(b),hideFlashOptions(b)},hideBannerOptions=a=>{$(a).find(".bannerOptions").hide()},showFlashOptions=a=>{let b=getDraggableParent(a);$(b).find(".flashOptions").show(),hideSliderOptions(b),hideBannerOptions(b)},hideFlashOptions=a=>{$(a).find(".flashOptions").hide()},hideAllOptions=a=>{let b=getDraggableParent(a);hideSliderOptions(b),hideBannerOptions(b),hideFlashOptions(b),toggleSidebar(a,!1)},updateSelect2Fields=()=>{$("select.select2").select2({tags:!0,allowClear:!0,placeholder:jsLang("Select an option")}),$(".select3").select2({allowClear:!0,placeholder:jsLang("Select an option")})};$("select.select2").select2({tags:!0,allowClear:!0,placeholder:jsLang("Select an option")}),$(".select3").select2({allowClear:!0,placeholder:jsLang("Select an option")}),$(document).on("change",".sidebar_options",function(){"0"==this.value?hideAllOptions(this):"banner"==this.value?(showBannerOptions(this),toggleSidebar(this,!0)):"slider"==this.value?(showSliderOptions(this),toggleSidebar(this,!0)):"flash_sale"==this.value&&(showFlashOptions(this),toggleSidebar(this,!0))}),$(document).ready(function(){updateSelect2Fields(),$(".select2").on("select2:select",function(a){var b=a.params.data.element,c=$(b);c.detach(),$(this).append(c),$(this).trigger("change")})}),$(document).on("click",".folding",function(){let a=this.closest(".ui-state-default");this.classList.contains("closed")?($(a).find(".dd-content").removeClass("card-hide"),$(this).removeClass("closed")):($(a).find(".dd-content").addClass("card-hide"),$(this).addClass("closed"))}),$(document).on("click",".header-text",function(){$(this).closest(".ui-state-default").find(".folding").trigger("click")}),$(document).on("click",".delete-button",function(){$("#component-title").html($(this).data("component")),deletingSection=this.closest(".ui-state-default"),deletingSectionId=$(this).data("component-id")}),$(document).on("click",".delete-section-btn",function(){toggleDeleteLoading(),updateCustomForm(deletingSectionId),"0"===deletingSectionId||0===deletingSectionId?gridDeleted(null,!0):ajaxRequest($("#internal_form"),__gridDeleteUrl,gridDeleted,"post")});const toggleDeleteLoading=()=>{$(".delete-loading").toggleClass("d-none")},gridDeleted=(a,b)=>{$(".modal").modal("hide"),toggleDeleteLoading(),b?(deletingSection.remove(),operationSuccess("Section deleted")):operationFailed("Section couldn't be deleted."),deletingSection=void 0,deletingSectionId=void 0},updateFormButton=a=>{$(a).find(".loading-spinner").toggleClass("d-none"),$("#update_page .loading-spinner").toggleClass("d-none")},updateAjaxMessage=(a,b,c="success")=>{$(a).find(".message").html(b),$(a).find(".message").addClass(`text-${c}`),setTimeout(a=>{$(a).find(".message").html("")},3e3)};$(".img-delete-icon").click(function(){let a=$(this).closest(".form-group");$(a).find(".custom-file-input").val(""),$(this).closest(".preview-image").html("")});const toggleSidebar=(a,b=!0)=>{let c=getDraggableParent(a);b?($(c).find(".sidebar-position").addClass(".crequired"),$(c).find(".sidebar-position").attr("required",""),$(c).find(".sidebarOption").removeClass("d-none")):($(c).find(".sidebar-position").removeClass(".crequired"),$(c).find(".sidebar-position").removeAttr("required",""),$(c).find(".sidebarOption").addClass("d-none"))};$(document).on("change",".seeMore",function(){let a=getDraggableParent(this);this.checked?($(this).closest(".parent-class").find(".more-link").addClass("crequired"),$(this).closest(".parent-class").find(".more-link").attr("required","")):($(this).closest(".parent-class").find(".more-link").removeClass("crequired"),$(this).closest(".parent-class").find(".more-link").removeAttr("required")),$(a).find(".moreLink").toggleClass("d-none")}),$(document).on("click",".selectable",function(){$(".selectable").removeClass("selectedBox"),$("#l_layout").val($(this).data("val")),$(this).addClass("selectedBox")});const validateFormData=a=>{let b=a.querySelectorAll(".crequired"),c=!0;return b.forEach(a=>{"none"===$(a).closest(".form-parent").css("display")||a.checkValidity()||(c=!1,addErrorMessage(a),console.log(a.name))}),c};$(document).on("keyup",".has-image",function(){1<this.value.length?($(this).closest(".parent-class").find(".is-image").attr("required",""),$(this).closest(".parent-class").find(".is-image").addClass("crequired")):($(this).closest(".parent-class").find(".is-image").removeAttr("required"),$(this).closest(".parent-class").find(".is-image").removeClass("crequired"),this.closest(".parent-class").querySelector(".is-image").setCustomValidity(""))}),$(document).on("click",".img-delete-icon",function(){$(this).closest(".parent-class").find(".is-image").val("")}),$(document).on("click",".img-remove-icon",function(){$(this).closest(".parent-class").find(".is-image").val("")}),$(".is-image").on("invalid",function(){return!1});const addErrorMessage=a=>{let b=a.parentNode;var c=b.querySelector(".error")||document.createElement("label");c.classList.add("error"),c.innerHTML="This field is required.",b.querySelector(".error")||(1<b.childElementCount?b.append(c):b.insertBefore(c,a.nextSibling))};$(document).on("input",".crequired",function(){(this.value||"0"===this.value||""!==this.value.trim())&&this.parentNode.querySelector(".error")&&this.parentNode.querySelector(".error").remove()});
